import{d as S}from"./chunk-GJ22ZM4Y.js";import{d as y,e as m,m as f,n as u,q as p,r as c,s as C,t as l}from"./chunk-H2T75OZR.js";import{d as v}from"./chunk-4CLCTAJ7.js";function g(o,t){return t>=o.startTime&&t<o.endTime}function E(o,t,s){let e=null,i=y();function n(){let r=u(t)?[t]:t,h=o.toArray().find(d=>r.includes(d.kind)&&d.mode==="showing");if(h!==e){if(!h){s(null),e=null;return}h.readyState==2?s(h):(s(null),m(()=>{let d=l(h,"load",()=>{s(h),d()},{once:!0})},i)),e=h}}return n(),l(o,"mode-change",n)}function R(o,t,s){E(o,t,e=>{if(!e){s("");return}let i=()=>{let n=e?.activeCues[0];s(n?.text||"")};i(),l(e,"cue-change",i)})}var b=Symbol(0),w=Symbol(0),O=Symbol(0),x=Symbol(0),N=Symbol(0),M=Symbol(0),_=Symbol(0),a={crossOrigin:b,readyState:w,updateActiveCues:O,canLoad:x,onModeChange:N,native:M,nativeHLS:_},T=class extends C{static createId(t){return`vds-${t.type}-${t.kind}-${t.src??t.label??"?"}`}src;content;type;encoding;id="";label="";language="";kind;default=!1;#r=!1;#e=0;#i="disabled";#o={};#n=[];#t=[];#s=[];[a.readyState]=0;[a.crossOrigin];[a.onModeChange]=null;[a.native]=null;get metadata(){return this.#o}get regions(){return this.#n}get cues(){return this.#t}get activeCues(){return this.#s}get readyState(){return this[a.readyState]}get mode(){return this.#i}set mode(t){this.setMode(t)}constructor(t){super();for(let s of Object.keys(t))this[s]=t[s];this.type||(this.type="vtt"),t.content?this.#l(t):t.src||(this[a.readyState]=2)}addCue(t,s){let e=0,i=this.#t.length;for(e=0;e<i&&!(t.endTime<=this.#t[e].startTime);e++);e===i?this.#t.push(t):this.#t.splice(e,0,t),t instanceof TextTrackCue||this[a.native]?.track.addCue(t),this.dispatchEvent(new c("add-cue",{detail:t,trigger:s})),g(t,this.#e)&&this[a.updateActiveCues](this.#e,s)}removeCue(t,s){let e=this.#t.indexOf(t);if(e>=0){let i=this.#s.includes(t);this.#t.splice(e,1),this[a.native]?.track.removeCue(t),this.dispatchEvent(new c("remove-cue",{detail:t,trigger:s})),i&&this[a.updateActiveCues](this.#e,s)}}setMode(t,s){this.#i!==t&&(this.#i=t,t==="disabled"?(this.#s=[],this.#u()):this.readyState===2?this[a.updateActiveCues](this.#e,s):this.#h(),this.dispatchEvent(new c("mode-change",{detail:this,trigger:s})),this[a.onModeChange]?.())}[a.updateActiveCues](t,s){if(this.#e=t,this.mode==="disabled"||!this.#t.length)return;let e=[];for(let n=0,r=this.#t.length;n<r;n++){let h=this.#t[n];g(h,t)&&e.push(h)}let i=e.length!==this.#s.length;if(!i){for(let n=0;n<e.length;n++)if(!this.#s.includes(e[n])){i=!0;break}}this.#s=e,i&&this.#u(s)}[a.canLoad](){this.#r=!0,this.#i!=="disabled"&&this.#h()}#l(t){import("./chunk-CFYJR53Y.js").then(({parseText:s,VTTCue:e,VTTRegion:i})=>{!u(t.content)||t.type==="json"?(this.#d(t.content,e,i),this.readyState!==3&&this.#a()):s(t.content,{type:t.type}).then(({cues:n,regions:r})=>{this.#t=n,this.#n=r,this.#a()})})}#h(){return v(this,null,function*(){if(!(!this.#r||this[a.readyState]>0)){if(this[a.readyState]=1,this.dispatchEvent(new c("load-start")),!this.src){this.#a();return}try{let{parseResponse:t,VTTCue:s,VTTRegion:e}=yield import("./chunk-CFYJR53Y.js"),i=this[a.crossOrigin]?.(),n=fetch(this.src,{headers:this.type==="json"?{"Content-Type":"application/json"}:void 0,credentials:S(i)});if(this.type==="json")this.#d(yield(yield n).text(),s,e);else{let{errors:r,metadata:h,regions:d,cues:A}=yield t(n,{type:this.type,encoding:this.encoding});if(r[0]?.code===0)throw r[0];this.#o=h,this.#n=d,this.#t=A}this.#a()}catch(t){this.#c(t)}}})}#a(){if(this[a.readyState]=2,!this.src||this.type!=="vtt"){let s=this[a.native];if(s&&!s.managed)for(let e of this.#t)s.track.addCue(e)}let t=new c("load");this[a.updateActiveCues](this.#e,t),this.dispatchEvent(t)}#c(t){this[a.readyState]=3,this.dispatchEvent(new c("error",{detail:t}))}#d(t,s,e){try{let{regions:i,cues:n}=I(t,s,e);this.#n=i,this.#t=n}catch(i){this.#c(i)}}#u(t){this.dispatchEvent(new c("cue-change",{trigger:t}))}},k=/captions|subtitles/;function J(o){return k.test(o.kind)}function I(o,t,s){let e=u(o)?JSON.parse(o):o,i=[],n=[];return e.regions&&s&&(i=e.regions.map(r=>Object.assign(new s,r))),(e.cues||p(e))&&(n=(p(e)?e:e.cues).filter(r=>f(r.startTime)&&f(r.endTime)).map(r=>Object.assign(new t(0,0,""),r))),{regions:i,cues:n}}export{g as a,E as b,R as c,a as d,T as e,J as f};
