import{a as C,b as g}from"./chunk-3U2SZYSW.js";import{a as T}from"./chunk-4E44A32L.js";import{a as P}from"./chunk-ALENSEJ7.js";import{a as p}from"./chunk-U6XIDZYM.js";import{e as w}from"./chunk-6TJZC2SC.js";import{b as v}from"./chunk-JAD4QJUG.js";import{a as o}from"./chunk-IIUTR2PI.js";import"./chunk-VUE4JCUK.js";import{a as h}from"./chunk-YH4K2B5K.js";import{F as d,I as l,Z as f,a as c,g as y,n as b,q as k,t as m}from"./chunk-LRNDPFQA.js";import{e as r}from"./chunk-JKOY2XUY.js";var I=["bufferend","bufferstart","durationchange","ended","enterpictureinpicture","error","fullscreenchange","leavepictureinpicture","loaded","playProgress","loadProgress","pause","play","playbackratechange","qualitychange","seeked","seeking","timeupdate","volumechange","waiting"],$=class extends T{$$PROVIDER_TYPE="VIMEO";scope=y();fullscreen;#e;#s=d("");#i=d(!1);#a=null;#c=null;#d=!1;#n=new o(0,0);#l=new P(this.#g.bind(this));#w=null;#r=null;#o=new Map;#u=null;constructor(e,t){super(e),this.#e=t;let s=this;this.fullscreen={get active(){return s.#d},supported:!0,enter:()=>this.#t("requestFullscreen"),exit:()=>this.#t("exitFullscreen")}}cookies=!1;title=!0;byline=!0;portrait=!0;color="00ADEF";get type(){return"vimeo"}get currentSrc(){return this.#c}get videoId(){return this.#s()}get hash(){return this.#a}get isPro(){return this.#i()}preconnect(){v(this.getOrigin())}setup(){super.setup(),l(this.#P.bind(this)),l(this.#T.bind(this)),l(this.#C.bind(this)),this.#e.notify("provider-setup",this)}destroy(){this.#m(),this.fullscreen=void 0;let e="provider destroyed";for(let t of this.#o.values())for(let{reject:s}of t)s(e);this.#o.clear(),this.#t("destroy")}play(){return r(this,null,function*(){return this.#t("play")})}pause(){return r(this,null,function*(){return this.#t("pause")})}setMuted(e){this.#t("setMuted",e)}setCurrentTime(e){this.#t("seekTo",e),this.#e.notify("seeking",e)}setVolume(e){this.#t("setVolume",e),this.#t("setMuted",c(this.#e.$state.muted))}setPlaybackRate(e){this.#t("setPlaybackRate",e)}loadSource(e){return r(this,null,function*(){if(!b(e.src)){this.#c=null,this.#a=null,this.#s.set("");return}let{videoId:t,hash:s}=C(e.src);this.#s.set(t??""),this.#a=s??null,this.#c=e})}#P(){this.#m();let e=this.#s();if(!e){this.src.set("");return}this.src.set(`${this.getOrigin()}/video/${e}`),this.#e.notify("load-start")}#T(){let e=this.#s();if(!e)return;let t=f(),s=new AbortController;return this.#u=t,g(e,s,this.#a).then(i=>{t.resolve(i)}).catch(i=>{t.reject()}),()=>{t.reject(),s.abort()}}#C(){let e=this.#i(),{$state:t,qualities:s}=this.#e;if(t.canSetPlaybackRate.set(e),s[h.setReadonly](!e),e)return m(s,"change",()=>{if(s.auto)return;let i=s.selected?.id;i&&this.#t("setQuality",i)})}getOrigin(){return"https://player.vimeo.com"}buildParams(){let{keyDisabled:e}=this.#e.$props,{playsInline:t,nativeControls:s}=this.#e.$state,i=s();return{title:this.title,byline:this.byline,color:this.color,portrait:this.portrait,controls:i,h:this.hash,keyboard:i&&!e(),transparent:!0,playsinline:t(),dnt:!this.cookies}}#g(){this.#t("getCurrentTime")}#h=!1;#$(e,t){if(this.#h&&e===0)return;let{realCurrentTime:s,paused:i,bufferedEnd:n,seekableEnd:a,live:u}=this.#e.$state;if(s()===e)return;let E=s();this.#e.notify("time-change",e,t),Math.abs(E-e)>1.5&&(this.#e.notify("seeking",e,t),!i()&&n()<e&&this.#e.notify("waiting",void 0,t)),!u()&&a()-e<.01&&(this.#e.notify("end",void 0,t),this.#h=!0,setTimeout(()=>{this.#h=!1},500))}#E(e,t){this.#e.notify("seeked",e,t)}#I(e){let t=this.#s();this.#u?.promise.then(s=>{if(!s)return;let{title:i,poster:n,duration:a,pro:u}=s;this.#i.set(u),this.#e.notify("title-change",i,e),this.#e.notify("poster-change",n,e),this.#e.notify("duration-change",a,e),this.#f(a,e)}).catch(()=>{t===this.#s()&&(this.#t("getVideoTitle"),this.#t("getDuration"))})}#f(e,t){let{nativeControls:s}=this.#e.$state,i=s();this.#n=new o(0,e);let n={buffered:new o(0,0),seekable:this.#n,duration:e};this.#e.delegate.ready(n,t),i||this.#t("_hideOverlay"),this.#t("getQualities"),this.#t("getChapters")}#V(e,t,s){switch(e){case"getVideoTitle":let i=t;this.#e.notify("title-change",i,s);break;case"getDuration":let n=t;this.#e.$state.canPlay()?this.#e.notify("duration-change",n,s):this.#f(n,s);break;case"getCurrentTime":this.#$(t,s);break;case"getBuffered":k(t)&&t.length&&this.#p(t[t.length-1][1],s);break;case"setMuted":this.#y(c(this.#e.$state.volume),t,s);break;case"getChapters":this.#L(t);break;case"getQualities":this.#F(t,s);break}this.#v(e)?.resolve()}#R(){for(let e of I)this.#t("addEventListener",e)}#A(e){this.#l.stop(),this.#e.notify("pause",void 0,e)}#M(e){this.#l.start(),this.#e.notify("play",void 0,e)}#S(e){let{paused:t}=this.#e.$state;!t()&&!this.#h&&this.#e.notify("playing",void 0,e)}#p(e,t){let s={buffered:new o(0,e),seekable:this.#n};this.#e.notify("progress",s,t)}#q(e){this.#e.notify("waiting",void 0,e)}#x(e){let{paused:t}=this.#e.$state;t()||this.#e.notify("playing",void 0,e)}#Q(e){let{paused:t}=this.#e.$state;t()&&this.#e.notify("play",void 0,e),this.#e.notify("waiting",void 0,e)}#y(e,t,s){let i={volume:e,muted:t};this.#e.notify("volume-change",i,s)}#L(e){if(this.#b(),!e.length)return;let t=new w({kind:"chapters",default:!0}),{seekableEnd:s}=this.#e.$state;for(let i=0;i<e.length;i++){let n=e[i],a=e[i+1];t.addCue(new window.VTTCue(n.startTime,a?.startTime??s(),n.title))}this.#r=t,this.#e.textTracks.add(t)}#b(){this.#r&&(this.#e.textTracks.remove(this.#r),this.#r=null)}#F(e,t){this.#e.qualities[p.enableAuto]=e.some(s=>s.id==="auto")?()=>this.#t("setQuality","auto"):void 0;for(let s of e){if(s.id==="auto")continue;let i=+s.id.slice(0,-1);isNaN(i)||this.#e.qualities[h.add]({id:s.id,width:i*(16/9),height:i,codec:"avc1,h.264",bitrate:-1},t)}this.#k(e.find(s=>s.active),t)}#k({id:e}={},t){if(!e)return;let s=e==="auto",i=this.#e.qualities.getById(e);s?(this.#e.qualities[p.setAuto](s,t),this.#e.qualities[h.select](void 0,!0,t)):this.#e.qualities[h.select](i??void 0,!0,t)}#O(e,t,s){switch(e){case"ready":this.#R();break;case"loaded":this.#I(s);break;case"play":this.#M(s);break;case"playProgress":this.#S(s);break;case"pause":this.#A(s);break;case"loadProgress":this.#p(t.seconds,s);break;case"waiting":this.#Q(s);break;case"bufferstart":this.#q(s);break;case"bufferend":this.#x(s);break;case"volumechange":this.#y(t.volume,c(this.#e.$state.muted),s);break;case"durationchange":this.#n=new o(0,t.duration),this.#e.notify("duration-change",t.duration,s);break;case"playbackratechange":this.#e.notify("rate-change",t.playbackRate,s);break;case"qualitychange":this.#k(t,s);break;case"fullscreenchange":this.#d=t.fullscreen,this.#e.notify("fullscreen-change",t.fullscreen,s);break;case"enterpictureinpicture":this.#e.notify("picture-in-picture-change",!0,s);break;case"leavepictureinpicture":this.#e.notify("picture-in-picture-change",!1,s);break;case"ended":this.#e.notify("end",void 0,s);break;case"error":this.#D(t,s);break;case"seek":case"seeked":this.#E(t.seconds,s);break}}#D(e,t){let{message:s,method:i}=e;i==="setPlaybackRate"&&this.#i.set(!1),i&&this.#v(i)?.reject(s)}onMessage(e,t){e.event?this.#O(e.event,e.data,t):e.method&&this.#V(e.method,e.value,t)}onLoad(){}#t(e,t){return r(this,null,function*(){let s=f(),i=this.#o.get(e);return i||this.#o.set(e,i=[]),i.push(s),this.postMessage({method:e,value:t}),s.promise})}#m(){this.#l.stop(),this.#n=new o(0,0),this.#u=null,this.#w=null,this.#i.set(!1),this.#b()}#v(e){return this.#o.get(e)?.shift()}};export{$ as VimeoProvider};
