import{a as O}from"./chunk-6I5UEK4C.js";import{b as v}from"./chunk-3IUBWZWC.js";import{a as f}from"./chunk-YH4K2B5K.js";import{a as G,d as c,p as N,s as L}from"./chunk-75WHGGER.js";import{C as o,F as d,I as l,a as E,f as g,g as P,k as x,n as $,r as A,t as r,u as h}from"./chunk-H2T75OZR.js";import{d as a}from"./chunk-4CLCTAJ7.js";var m=null,p=[],y=[];function w(){return m??=new AudioContext}function U(){let s=w(),t=s.createGain();return t.connect(s.destination),p.push(t),t}function j(s,t){let i=w(),e=i.createMediaElementSource(s);return t&&e.connect(t),y.push(e),e}function q(s){let t=p.indexOf(s);t!==-1&&(p.splice(t,1),s.disconnect(),I())}function B(s){let t=y.indexOf(s);t!==-1&&(y.splice(t,1),s.disconnect(),I())}function I(){m&&p.length===0&&y.length===0&&m.close().then(()=>{m=null})}var b=class{#s;#t;#e=null;#n=null;get currentGain(){return this.#e?.gain?.value??null}get supported(){return!0}constructor(t,i){this.#s=t,this.#t=i}setGain(t){let i=this.currentGain;if(t!==this.currentGain){if(t===1&&i!==1){this.removeGain();return}this.#e||(this.#e=U(),this.#n&&this.#n.connect(this.#e)),this.#n||(this.#n=j(this.#s,this.#e)),this.#e.gain.value=t,this.#t(t)}}removeGain(){this.#e&&(this.#n&&this.#n.connect(w().destination),this.#r(),this.#t(null))}destroy(){this.#h(),this.#r()}#h(){if(this.#n)try{B(this.#n)}catch{}finally{this.#n=null}}#r(){if(this.#e)try{q(this.#e)}catch{}finally{this.#e=null}}},V=["focus","blur","visibilitychange","pageshow","pagehide"],S=class{#s=d(R());#t=d(document.visibilityState);#e;connect(){let t=new h(window),i=this.#n.bind(this);for(let e of V)t.add(e,i);c&&t.add("beforeunload",e=>{this.#e=setTimeout(()=>{e.defaultPrevented||e.returnValue.length>0||(this.#s.set("hidden"),this.#t.set("hidden"))},0)})}get pageState(){return this.#s()}get visibility(){return this.#t()}#n(t){c&&window.clearTimeout(this.#e),(t.type!=="blur"||this.#s()==="active")&&(this.#s.set(R(t)),this.#t.set(document.visibilityState=="hidden"?"hidden":"visible"))}};function R(s){return s?.type==="blur"||document.visibilityState==="hidden"?"hidden":document.hasFocus()?"active":"passive"}var k=class{#s;#t;#e=!1;#n=!1;#h=!1;#r=new O(this.#y.bind(this));#o=new S;#c;get#i(){return this.#s.media}constructor(t,i){this.#s=t,this.#t=i,this.#c=new h(t.media),this.#g(),this.#o.connect(),l(this.#O.bind(this)),g(this.#p.bind(this))}#p(){this.#n=!1,this.#h=!1,this.#r.stop(),this.#c.abort(),this.#S?.clear()}#u=0;#l=-1;#y(){let t=this.#i.currentTime;!(c&&t-this.#l<.35)&&this.#u!==t&&(this.#d(t),this.#u=t)}#g(){this.#a("loadstart",this.#k),this.#a("abort",this.#m),this.#a("emptied",this.#T),this.#a("error",this.#V),this.#a("volumechange",this.#I)}#v(){this.#n||(this.#a("loadeddata",this.#w),this.#a("loadedmetadata",this.#C),this.#a("canplay",this.#x),this.#a("canplaythrough",this.#$),this.#a("durationchange",this.#D),this.#a("play",this.#E),this.#a("progress",this.#j),this.#a("stalled",this.#G),this.#a("suspend",this.#q),this.#a("ratechange",this.#B),this.#n=!0)}#b(){this.#h||(this.#a("pause",this.#P),this.#a("playing",this.#A),this.#a("seeked",this.#F),this.#a("seeking",this.#U),this.#a("ended",this.#L),this.#a("waiting",this.#N),this.#h=!0)}#S=void 0;#M=void 0;#a(t,i){this.#c.add(t,i.bind(this))}#W(t){}#d(t,i){let e=Math.min(t,this.#t.$state.seekableEnd());this.#t.notify("time-change",e,i)}#k(t){if(this.#i.networkState===3){this.#m(t);return}this.#v(),this.#t.notify("load-start",void 0,t)}#m(t){this.#t.notify("abort",void 0,t)}#T(){this.#t.notify("emptied",void 0,event)}#w(t){this.#t.notify("loaded-data",void 0,t)}#C(t){this.#u=0,this.#l=-1,this.#b(),this.#t.notify("loaded-metadata",void 0,t),(G||c&&N(this.#t.$state.source()))&&this.#t.delegate.ready(this.#f(),t)}#f(){return{provider:E(this.#t.$provider),duration:this.#i.duration,buffered:this.#i.buffered,seekable:this.#i.seekable}}#E(t){this.#t.$state.canPlay&&this.#t.notify("play",void 0,t)}#P(t){this.#i.readyState===1&&!this.#e||(this.#e=!1,this.#r.stop(),this.#t.notify("pause",void 0,t))}#x(t){this.#t.delegate.ready(this.#f(),t)}#$(t){this.#t.$state.started()||this.#t.notify("can-play-through",this.#f(),t)}#A(t){this.#i.paused||(this.#e=!1,this.#t.notify("playing",void 0,t),this.#r.start())}#G(t){this.#t.notify("stalled",void 0,t),this.#i.readyState<3&&(this.#e=!0,this.#t.notify("waiting",void 0,t))}#N(t){this.#i.readyState<3&&(this.#e=!0,this.#t.notify("waiting",void 0,t))}#L(t){this.#r.stop(),this.#d(this.#i.duration,t),this.#t.notify("end",void 0,t),this.#t.$state.loop()&&x(this.#i.controls)&&(this.#i.controls=!1)}#O(){let t=this.#t.$state.paused(),i=this.#o.visibility==="hidden";(t||i)&&r(this.#i,"timeupdate",this.#R.bind(this))}#R(t){this.#d(this.#i.currentTime,t)}#D(t){this.#t.$state.ended()&&this.#d(this.#i.duration,t),this.#t.notify("duration-change",this.#i.duration,t)}#I(t){let i={volume:this.#i.volume,muted:this.#i.muted};this.#t.notify("volume-change",i,t)}#F(t){this.#l=this.#i.currentTime,this.#d(this.#i.currentTime,t),this.#t.notify("seeked",this.#i.currentTime,t),Math.trunc(this.#i.currentTime)===Math.trunc(this.#i.duration)&&v(this.#i.duration)>v(this.#i.currentTime)&&(this.#d(this.#i.duration,t),this.#i.ended||this.#t.player.dispatch(new A("media-play-request",{trigger:t})))}#U(t){this.#t.notify("seeking",this.#i.currentTime,t)}#j(t){let i={buffered:this.#i.buffered,seekable:this.#i.seekable};this.#t.notify("progress",i,t)}#q(t){this.#t.notify("suspend",void 0,t)}#B(t){this.#t.notify("rate-change",this.#i.playbackRate,t)}#V(t){let i=this.#i.error;if(!i)return;let e={message:i.message,code:i.code,mediaError:i};this.#t.notify("error",e,t)}},T=class{#s;#t;get#e(){return this.#s.media.audioTracks}constructor(t,i){this.#s=t,this.#t=i,this.#e.onaddtrack=this.#n.bind(this),this.#e.onremovetrack=this.#h.bind(this),this.#e.onchange=this.#r.bind(this),r(this.#t.audioTracks,"change",this.#c.bind(this))}#n(t){let i=t.track;if(i.label==="")return;let e=i.id.toString()||`native-audio-${this.#t.audioTracks.length}`,n={id:e,label:i.label,language:i.language,kind:i.kind,selected:!1};this.#t.audioTracks[f.add](n,t),i.enabled&&(n.selected=!0)}#h(t){let i=this.#t.audioTracks.getById(t.track.id);i&&this.#t.audioTracks[f.remove](i,t)}#r(t){let i=this.#o();if(!i)return;let e=this.#t.audioTracks.getById(i.id);e&&this.#t.audioTracks[f.select](e,!0,t)}#o(){return Array.from(this.#e).find(t=>t.enabled)}#c(t){let{current:i}=t.detail;if(!i)return;let e=this.#e.getTrackById(i.id);if(e){let n=this.#o();n&&(n.enabled=!1),e.enabled=!0}}},D=class{constructor(t,i){this.media=t,this.ctx=i,this.audioGain=new b(t,e=>{this.ctx.notify("audio-gain-change",e)})}scope=P();currentSrc=null;audioGain;setup(){new k(this,this.ctx),"audioTracks"in this.media&&new T(this,this.ctx),g(()=>{this.audioGain.destroy(),this.media.srcObject=null,this.media.removeAttribute("src");for(let t of this.media.querySelectorAll("source"))t.remove();this.media.load()})}get type(){return""}setPlaybackRate(t){this.media.playbackRate=t}play(){return a(this,null,function*(){return this.media.play()})}pause(){return a(this,null,function*(){return this.media.pause()})}setMuted(t){this.media.muted=t}setVolume(t){this.media.volume=t}setCurrentTime(t){this.media.currentTime=t}setPlaysInline(t){o(this.media,"playsinline",t)}loadSource(n,u){return a(this,arguments,function*({src:t,type:i},e){this.media.preload=e||"",L(t)?(this.removeSource(),this.media.srcObject=t):(this.media.srcObject=null,$(t)?i!=="?"?this.appendSource({src:t,type:i}):(this.removeSource(),this.media.src=this.#s(t)):(this.removeSource(),this.media.src=window.URL.createObjectURL(t))),this.media.load(),this.currentSrc={src:t,type:i}})}appendSource(t,i){let e=this.media.querySelector("source[data-vds]"),n=e??document.createElement("source");o(n,"src",this.#s(t.src)),o(n,"type",t.type!=="?"?t.type:i),o(n,"data-vds",""),e||this.media.append(n)}removeSource(){this.media.querySelector("source[data-vds]")?.remove()}#s(t){let{clipStartTime:i,clipEndTime:e}=this.ctx.$state,n=i(),u=e();return n>0&&u>0?`${t}#t=${n},${u}`:n>0?`${t}#t=${n}`:u>0?`${t}#t=0,${u}`:t}};var C=class{#s;#t;#e;#n=d(!1);get supported(){return this.#n()}constructor(t,i){this.#s=t,this.#t=i,this.#h()}#h(){!this.#s?.remote||!this.canPrompt||(this.#s.remote.watchAvailability(t=>{this.#n.set(t)}).catch(()=>{this.#n.set(!1)}),l(this.#r.bind(this)))}#r(){if(!this.#n())return;let t=["connecting","connect","disconnect"],i=this.#o.bind(this);i(),r(this.#s,"playing",i);let e=new h(this.#s.remote);for(let n of t)e.add(n,i)}prompt(){return a(this,null,function*(){if(!this.supported)throw Error("Not supported on this platform.");return this.type==="airplay"&&this.#s.webkitShowPlaybackTargetPicker?this.#s.webkitShowPlaybackTargetPicker():this.#s.remote.prompt()})}#o(t){let i=this.#s.remote.state;if(i===this.#e)return;let e={type:this.type,state:i};this.#t.notify("remote-playback-change",e,t),this.#e=i}},F=class extends C{type="airplay";get canPrompt(){return"WebKitPlaybackTargetAvailabilityEvent"in window}};export{D as a,F as b};
