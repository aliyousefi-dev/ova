<div class="video-player-container"
     (mouseenter)="showControls = true"
     (mouseleave)="showControls = false"
     (mousemove)="resetControlsTimeout()"
     [class.hide-cursor]="isPlaying && !showControls && !isDragging">
    <video #videoElement class="video-element"
           disablepictureinpicture
           (click)="togglePlay()"
           (dblclick)="toggleFullScreen()">
    </video>

    <div class="center-play-button-overlay" *ngIf="!isPlaying || showControls" (click)="togglePlay()">
        <span class="material-symbols-rounded center-play-icon" *ngIf="!isPlaying">play_arrow</span>
        <span class="material-symbols-rounded center-play-icon" *ngIf="isPlaying">pause</span>
    </div>

    <div class="video-controls" [class.active]="showControls || !isPlaying">
        <div class="progress-container"
             #progressBarContainer
             (mousedown)="onProgressBarMouseDown($event)"
             (mouseleave)="onProgressBarMouseLeave()">
            <div *ngFor="let range of getBufferedRangesArray()"
                 class="buffered-range"
                 [style.left]="(range.start / totalDuration) * 100 + '%'"
                 [style.width]="((range.end - range.start) / totalDuration) * 100 + '%'">
            </div>

            <div class="progress-bar-fill"
                 [style.width]="(currentTime / totalDuration) * 100 + '%'">
            </div>

            <div class="progress-handle"
                 [style.left]="(currentTime / totalDuration) * 100 + '%'"
                 (mousedown)="onHandleMouseDown($event)">
            </div>
        </div>

        <button class="control-button play-pause-button" (click)="togglePlay()">
            <span class="material-symbols-rounded">
                {{ isPlaying ? 'pause' : 'play_arrow' }}
            </span>
        </button>

        <span class="time-display current-time">{{ formatTime(currentTime) }}</span>
        <span class="time-separator">/</span> <span class="time-display total-duration">{{ formatTime(totalDuration) }}</span>

        <div class="volume-control">
            <button class="control-button volume-button" (click)="toggleMute()">
                <span class="material-symbols-rounded">
                    {{ isMuted || volume === 0 ? 'volume_off' : volume < 0.5 ? 'volume_down' : 'volume_up' }}
                </span>
            </button>
            <input type="range" min="0" max="1" step="0.01" [(ngModel)]="volume" (input)="setVolume()"
                   class="volume-slider">
        </div>

        <button class="control-button fullscreen-button" (click)="toggleFullScreen()">
            <span class="material-symbols-rounded">
                {{ isFullScreen ? 'fullscreen_exit' : 'fullscreen' }}
            </span>
        </button>
    </div>
</div>