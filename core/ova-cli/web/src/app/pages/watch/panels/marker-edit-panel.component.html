<div class="marker-edit-panel bg-base-100 rounded-lg w-full">
  <div class="flex justify-between space-x-4 mb-6">
    <button type="button" class="btn btn-outline" (click)="addMarker()">
      + Add Marker
    </button>

    <div class="flex space-x-3">
      <button
        type="button"
        class="btn btn-neutral"
        (click)="fetchMarkers()"
        [disabled]="saving"
      >
        Reset
      </button>
      <button
        type="button"
        class="btn btn-neutral"
        (click)="saveMarkers()"
        [disabled]="saving"
      >
        {{ saving ? "Saving..." : "Save" }}
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="text-center text-info mb-2">
    Loading markers...
  </div>

  <div
    *ngIf="globalError"
    class="alert alert-error text-error-content mb-4 shadow-lg rounded-md"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="stroke-current shrink-0 h-6 w-6"
      fill="none"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
      />
    </svg>
    <span>Error: {{ globalError }}</span>
  </div>

  <div
    *ngIf="successMessage"
    class="alert alert-success text-success-content my-4 shadow-lg rounded-md"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="stroke-current shrink-0 h-6 w-6"
      fill="none"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
      />
    </svg>
    <span>{{ successMessage }}</span>
  </div>

  <div *ngIf="!loading && !globalError">
    <div
      *ngFor="let marker of markers; let i = index"
      class="flex flex-col gap-1 mb-3 p-2 border border-base-200 rounded-md"
    >
      <div class="flex items-center gap-2">
        <input
          type="text"
          [value]="secondsToDisplay(marker.timestamp)"
          (input)="onTimestampInput($event, i)"
          class="input input-sm w-24"
          [ngClass]="{ 'input-error': markerErrors[i].timestamp }"
          placeholder="mm:ss or hh:mm:ss"
          aria-label="Marker timestamp"
        />

        <input
          type="text"
          [(ngModel)]="marker.title"
          (input)="onTitleInput($event, i)"
          placeholder="Marker title"
          class="input input-sm flex-grow"
          [ngClass]="{ 'input-error': markerErrors[i].title }"
          aria-label="Marker title"
        />

        <button
          type="button"
          class="btn btn-error btn-sm"
          (click)="removeMarker(i)"
          aria-label="Remove marker"
        >
          <i-lucide [img]="RemoveIcon" class="w-3 h-3"></i-lucide>
        </button>
      </div>

      <div *ngIf="markerErrors[i]?.timestamp" class="text-error text-xs ml-2">
        {{ markerErrors[i].timestamp }}
      </div>

      <div *ngIf="markerErrors[i]?.title" class="text-error text-xs ml-2">
        {{ markerErrors[i].title }}
      </div>
    </div>
  </div>
</div>
