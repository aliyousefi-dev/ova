<app-navbar [title]="'Watch'"></app-navbar>

<main
  class="flex w-full min-h-screen overflow-x-hidden max-w-7xl mx-auto gap-8"
>
  <section *ngIf="loading" class="text-center py-10 w-full">
    <p class="text-lg">Loading video...</p>
  </section>

  <section *ngIf="error" class="text-center py-10 w-full">
    <p class="text-lg font-semibold">⚠️ Failed to load video</p>
  </section>

  <section
    *ngIf="!loading && !error && video"
    class="flex flex-col lg:flex-row gap-8 w-full"
  >
    <div class="flex-grow max-w-4xl flex flex-col">
      <!-- Use the new VideoActionBarComponent -->
      <app-video-action-bar
        [videoTitle]="video.title"
        [isSaved]="isSaved"
        [loadingSavedVideo]="loadingSavedVideo"
        (addToPlaylist)="addToPlaylist($event)"
        (toggleSaved)="toggleSaved()"
      ></app-video-action-bar>

      <div class="overflow-hidden">
        <ng-container *ngIf="true; else defaultPlayer">
          <app-vidstack-player
            [videoUrl]="videoUrl"
            [posterUrl]="thumbnailUrl"
            [vttUrl]="storyboardVttUrl"
            [vttMarkers]="markerFileUrl"
          ></app-vidstack-player>
        </ng-container>

        <ng-template #defaultPlayer>
          <app-default-video-player
            [videoUrl]="videoUrl"
            [posterUrl]="thumbnailUrl"
          ></app-default-video-player>
        </ng-template>
      </div>

      <div class="flex flex-col gap-6 pt-2">
        <!-- Use the new VideoMetadataPanelComponent -->
        <app-video-metadata-panel
          [videoId]="video.videoId"
          [videoDurationSeconds]="video.durationSeconds"
          [videoUploadedAt]="video.uploadedAt"
          [videoResolution]="video.resolution"
        ></app-video-metadata-panel>

        <app-video-tags-panel [tags]="video.tags"></app-video-tags-panel>

        <!-- name of each tab group should be unique -->
        <div class="tabs tabs-lift w-full">
          <input
            type="radio"
            name="my_tabs_6"
            class="tab"
            aria-label="Tag Editor"
            checked="checked"
          />
          <div class="tab-content bg-base-100 border-base-300 p-6">
            <!-- Use the TagManagementPanelComponent (already renamed) -->
            <app-tag-management-panel
              [videoId]="video.videoId"
              [currentTags]="video.tags"
              (tagsUpdated)="video.tags = $event"
            ></app-tag-management-panel>
          </div>

          <input
            type="radio"
            name="my_tabs_6"
            class="tab"
            aria-label="Marker Editor"
          />
          <div class="tab-content bg-base-100 border-base-300 p-6">
            <app-marker-edit-panel
              [videoId]="video.videoId"
            ></app-marker-edit-panel>
          </div>
        </div>
      </div>
    </div>

    <aside class="w-full lg:w-80 mt-10 lg:self-start p-5">
      <!-- Use the SimilarVideosPanelComponent (already renamed) -->
      <app-similar-videos-panel
        [currentVideoId]="videoId!"
        (navigateToVideo)="navigateToVideo($event)"
      ></app-similar-videos-panel>
    </aside>
  </section>
</main>

<app-playlist-modal
  [visible]="playlistModalVisible"
  [playlists]="playlists"
  (close)="closePlaylistModal($event)"
></app-playlist-modal>
