<app-navbar [title]="'Watch'"></app-navbar>

<main
  class="flex w-full min-h-screen max-w-7xl mx-auto gap-8 overflow-x-hidden"
>
  <section *ngIf="loading" class="text-center py-10 w-full">
    <p class="text-lg">Loading video...</p>
  </section>

  <section *ngIf="error" class="text-center py-10 w-full">
    <p class="text-lg font-semibold">⚠️ Failed to load video</p>
  </section>

  <section
    *ngIf="!loading && !error && video"
    class="flex flex-col lg:flex-row gap-8 w-full"
  >
    <div class="flex-grow max-w-4xl flex flex-col">
      <!-- Action Bar -->
      <app-video-action-bar
        [videoTitle]="video.title"
        [isSaved]="isSaved"
        [loadingSavedVideo]="loadingSavedVideo"
        (addToPlaylist)="addToPlaylist($event)"
        (toggleSaved)="toggleSaved()"
      ></app-video-action-bar>

      <!-- Video Player -->
      <div class="overflow-hidden">
        <ng-container *ngIf="true; else defaultPlayer">
          <app-vidstack-player
            #vidstackPlayer
            [videoUrl]="videoUrl"
            [posterUrl]="thumbnailUrl"
            [vttUrl]="storyboardVttUrl"
            [vttMarkersUrl]="markerFileUrl"
          ></app-vidstack-player>
        </ng-container>
        <ng-template #defaultPlayer>
          <app-default-video-player
            [videoUrl]="videoUrl"
            [posterUrl]="thumbnailUrl"
          ></app-default-video-player>
        </ng-template>
      </div>

      <!-- Info Panels -->
      <div class="flex flex-col gap-6 pt-4 pb-12">
        <app-video-metadata-panel
          [videoId]="video.videoId"
          [videoDurationSeconds]="video.durationSeconds"
          [videoUploadedAt]="video.uploadedAt"
          [videoResolution]="video.resolution"
        ></app-video-metadata-panel>

        <app-video-download-panel
          [videoId]="video.videoId"
          [getCurrentTimeFn]="getCurrentTimeFromPlayer"
        ></app-video-download-panel>

        <app-video-tags-panel [tags]="video.tags"></app-video-tags-panel>

        <app-video-admin-tabs
          #adminTabs
          [videoId]="video.videoId"
          [currentTags]="video.tags"
          (tagsUpdated)="video.tags = $event"
          (addMarkerClicked)="onAddMarkerClicked()"
        ></app-video-admin-tabs>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="w-full lg:w-80 mt-10 lg:self-start p-5">
      <app-similar-videos-panel
        [currentVideoId]="videoId!"
        (navigateToVideo)="navigateToVideo($event)"
      ></app-similar-videos-panel>
    </aside>
  </section>
</main>

<app-playlist-modal
  [visible]="playlistModalVisible"
  [playlists]="playlists"
  (close)="closePlaylistModal($event)"
></app-playlist-modal>
