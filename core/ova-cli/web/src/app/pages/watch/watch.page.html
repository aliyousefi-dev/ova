<main class="w-full min-h-screen pt-1 md:px-10 mx-auto overflow-x-hidden">
  <!-- Loading and Error States -->
  <section *ngIf="loading" class="text-center py-10 w-full">
    <p class="text-lg">Loading video...</p>
  </section>

  <section *ngIf="error" class="text-center py-10 w-full">
    <p class="text-lg font-semibold">⚠️ Failed to load video</p>
  </section>

  <section
    *ngIf="!loading && !error && video"
    class="flex flex-col items-center w-full"
  >
    <!-- Video and Sidebar Wrapper -->
    <div class="w-full mx-auto px-4 pt-5 flex flex-col md:flex-row gap-8">
      <!-- Video Area (70%) -->
      <div class="w-full flex flex-col">
        <div class="flex flex-col py-3">
          <app-video-action-bar
            [videoId]="video.videoId"
            [isSaved]="isSaved"
            [loadingSavedVideo]="loadingSavedVideo"
            (toggleSaved)="toggleSaved()"
            (addToPlaylist)="addToPlaylist($event)"
            [getCurrentTimeFn]="getCurrentTimeFromPlayer"
            [videoDurationSeconds]="video.durationSeconds"
            [videoUploadedAt]="video.uploadedAt"
            [videoResolution]="video.resolution"
          ></app-video-action-bar>
        </div>
        <!-- Title -->
        <app-video-title-bar [videoTitle]="video.title"></app-video-title-bar>

        <!-- Video Player -->
        <div class="w-full overflow-hidden">
          <ng-container *ngIf="true; else defaultPlayer">
            <app-vidstack-player
              #vidstackPlayer
              [videoUrl]="videoUrl"
              [posterUrl]="thumbnailUrl"
              [vttUrl]="storyboardVttUrl"
              [vttMarkersUrl]="markerFileUrl"
            ></app-vidstack-player>
          </ng-container>
          <ng-template #defaultPlayer>
            <app-default-video-player
              [videoUrl]="videoUrl"
              [posterUrl]="thumbnailUrl"
            ></app-default-video-player>
          </ng-template>
        </div>

        <!-- Metadata badges -->
        <div class="flex flex-col gap-10 p-5">
          <div class="flex flex-wrap gap-5 w-full text-xs">
            <span
              *ngIf="video.uploadedAt"
              class="inline-flex items-center gap-1 px-3 py-1 font-medium"
              [title]="video.uploadedAt"
            >
              <i class="bx bx-time text-xl"></i>
              <span>{{ video.uploadedAt | date : "mediumDate" }}</span>
            </span>

            <span
              *ngIf="video.resolution"
              class="inline-flex items-center gap-1 px-3 py-1 font-medium"
              [title]="video.resolution.width + 'x' + video.resolution.height"
            >
              <i class="bx bx-desktop text-xl"></i>
              <span
                >{{ video.resolution.width }} x {{ video.resolution.height
                }}</span
              >
            </span>

            <span
              *ngIf="video.durationSeconds !== undefined"
              class="inline-flex items-center gap-1 px-3 py-1 font-medium"
              [title]="formatTime(video.durationSeconds)"
            >
              <i class="bx bx-time text-xl"></i>
              <span>{{ formatTime(video.durationSeconds) }}</span>
            </span>

            <span class="inline-flex items-center gap-1 px-3 py-1 font-medium">
              <i class="bx bx-video text-xl"></i>
              <span>30 fps</span>
            </span>
          </div>
        </div>

        <!-- Video Info Panels -->

        <div
          class="flex flex-col gap-6 p-6 pb-10 bg-base-100 rounded-xl shadow-md"
        >
          <app-video-tags-panel [tags]="video.tags"></app-video-tags-panel>
        </div>
        <div
          class="flex flex-col gap-6 mt-6 p-6 pb-10 bg-base-100 rounded-xl shadow-md"
        >
          <app-video-admin-tabs
            #adminTabs
            [videoId]="video.videoId"
            [currentTags]="video.tags"
            (tagsUpdated)="video.tags = $event"
            (addMarkerClicked)="onAddMarkerClicked()"
          ></app-video-admin-tabs>
        </div>
      </div>

      <!-- Sidebar + Comments Column (30%) -->
      <div class="w-full md:w-[30%] md:mt-15 flex flex-col gap-6">
        <!-- Video Comment Panel inserted here -->
        <app-video-comment-panel
          [videoId]="video.videoId"
        ></app-video-comment-panel>

        <!-- Similar Videos Sidebar -->
        <app-similar-videos-panel
          [currentVideoId]="videoId!"
          (navigateToVideo)="navigateToVideo($event)"
        ></app-similar-videos-panel>
      </div>
    </div>
  </section>
</main>

<!-- Playlist Modal -->
<app-playlist-modal
  [visible]="playlistModalVisible"
  [playlists]="playlists"
  (close)="closePlaylistModal($event)"
></app-playlist-modal>
